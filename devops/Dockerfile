FROM mcr.microsoft.com/azure-cli

LABEL maintainer="Microsoft Corporation"

RUN az login --service-principal -u [AZURE_CLIENT_ID] -p=[AZURE_CLIENT_SECRET] --tenant [AZURE_TENANT_ID] && \
az account set -s [AZURE_SUBSCRIPTION_ID] && \
az aks get-credentials -n [ASO-AZDO-AKS] -g [ASO-RESOURCEGROUP] --admin

WORKDIR /

COPY . ./

ENV AZURE_CLIENT_ID [AZURE_CLIENT_ID]
ENV AZURE_CLIENT_SECRET [AZURE_CLIENT_SECRET]
ENV AZURE_SUBSCRIPTION_ID [AZURE_SUBSCRIPTION_ID]
ENV AZURE_TENANT_ID [AZURE_TENANT_ID]
ENV AZURE_OPERATOR_KEYVAULT [AZURE_OPERATOR_KEYVAULT]
ENV ASO-AZDO-AKS [ASO-AZDO-AKS]
ENV ASO-RESOURCEGROUP [ASO-RESOURCEGROUP]
ENV REQUEUE_AFTER "30"

ENTRYPOINT ["/manager"]